<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Query Optimizer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #FF4500;
            --secondary: #FF6347;
            --accent: #4CAF50;
            --warning: #ff9800;
            --danger: #f44336;
            --dark: #333;
            --light: #fff;
            --card-bg: rgba(255, 255, 255, 0.15);
            --hover-bg: rgba(255, 255, 255, 0.25);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            text-align: center;
            padding: 20px;
            background: linear-gradient(to right, #FF4500, #FF6347, #FF7F50, #FF8C00, #FFA07A);
            color: #FFFFFF;
            animation: gradientShift 10s ease infinite;
            min-height: 100vh;
        }

        @keyframes gradientShift {
            0% { background: linear-gradient(to right, #FF4500, #FF6347); }
            50% { background: linear-gradient(to right, #FF8C00, #FFA07A); }
            100% { background: linear-gradient(to right, #FF4500, #FF6347); }
        }

        .optimizer-container {
            max-width: 1200px;
            margin: auto;
            padding: 30px;
            border-radius: 12px;
            background-color: rgba(255, 255, 255, 0.1);
            box-shadow: 0px 8px 15px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease;
        }

        .optimizer-container:hover {
            transform: scale(1.01);
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .subtitle {
            font-size: 1.2em;
            margin-bottom: 30px;
            opacity: 0.9;
        }

        /* Layout */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        /* Input Section */
        .input-section {
            text-align: left;
        }

        .input-section h2, .results-section h2 {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        textarea {
            width: 100%;
            height: 250px;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            background-color: rgba(0, 0, 0, 0.8);
            color: lime;
            border: 1px solid rgba(255, 255, 255, 0.3);
            resize: vertical;
            margin-bottom: 15px;
        }

        textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.3);
        }

        .query-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            background-color: var(--accent);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            text-decoration: none;
            font-size: 1em;
            transition: background-color 0.3s ease, transform 0.3s ease;
            font-weight: 600;
        }

        .button:hover {
            background-color: #45a049;
            transform: translateY(-2px);
        }

        .button.secondary {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .button.secondary:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }

        .button.warning {
            background-color: var(--warning);
        }

        .button.warning:hover {
            background-color: #e68900;
        }

        /* Results Section */
        .results-section {
            text-align: left;
        }

        .results-tabs {
            display: flex;
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
            margin-bottom: 15px;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .tab.active {
            border-bottom: 3px solid var(--accent);
            background-color: rgba(255, 255, 255, 0.1);
        }

        .tab-content {
            display: none;
            padding: 15px;
            border-radius: 6px;
            background-color: rgba(255, 255, 255, 0.1);
            min-height: 200px;
        }

        .tab-content.active {
            display: block;
        }

        /* Metrics Dashboard */
        .metrics-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .metric-card {
            padding: 15px;
            border-radius: 8px;
            background-color: rgba(255, 255, 255, 0.1);
            text-align: center;
        }

        .metric-value {
            font-size: 1.8em;
            font-weight: bold;
            margin: 5px 0;
        }

        .metric-label {
            font-size: 0.9em;
            opacity: 0.8;
        }

        /* Suggestions List */
        .suggestion-list {
            list-style-type: none;
        }

        .suggestion-item {
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 6px;
            background-color: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .suggestion-icon {
            font-size: 1.2em;
            margin-top: 2px;
        }

        .suggestion-info {
            flex-grow: 1;
            text-align: left;
        }

        .suggestion-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .suggestion-desc {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .suggestion-severity {
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .severity-low {
            background-color: rgba(76, 175, 80, 0.3);
        }

        .severity-medium {
            background-color: rgba(255, 152, 0, 0.3);
        }

        .severity-high {
            background-color: rgba(244, 67, 54, 0.3);
        }

        /* Chart Container */
        .chart-container {
            position: relative;
            height: 200px;
            margin: 20px 0;
        }

        /* Query History */
        .history-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .history-item {
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 6px;
            background-color: rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .history-item:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .history-query {
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .history-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.8em;
            opacity: 0.7;
            margin-top: 5px;
        }

        /* Status Indicators */
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-optimal {
            background-color: #4CAF50;
        }

        .status-warning {
            background-color: #ff9800;
        }

        .status-poor {
            background-color: #f44336;
        }

        /* Responsive Design */
        @media (max-width: 600px) {
            .query-actions {
                flex-direction: column;
            }
            
            .button {
                justify-content: center;
            }
            
            .metrics-dashboard {
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="optimizer-container">
        <h1><i class="fas fa-rocket"></i> Advanced Query Optimizer</h1>
        <p class="subtitle">Analyze, optimize, and improve your SQL queries with AI-powered suggestions</p>
        
        <div class="main-content">
            <!-- Input Section -->
            <div class="input-section">
                <h2><i class="fas fa-code"></i> SQL Query Input</h2>
                <textarea id="queryInput" placeholder="Paste your SQL query here...">SELECT * 
FROM customers c
JOIN orders o ON c.customer_id = o.customer_id
WHERE c.country = 'USA'
ORDER BY o.order_date DESC;</textarea>
                
                <div class="query-actions">
                    <button class="button" onclick="optimizeQuery()">
                        <i class="fas fa-bolt"></i> Optimize Query
                    </button>
                    <button class="button secondary" onclick="analyzeQuery()">
                        <i class="fas fa-chart-bar"></i> Analyze Only
                    </button>
                    <button class="button secondary" onclick="clearQuery()">
                        <i class="fas fa-eraser"></i> Clear
                    </button>
                    <button class="button secondary" onclick="loadSampleQuery()">
                        <i class="fas fa-vial"></i> Load Sample
                    </button>
                </div>
                
                <div class="metrics-dashboard">
                    <div class="metric-card">
                        <div class="metric-label">Complexity Score</div>
                        <div class="metric-value" id="complexityScore">-</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Performance Score</div>
                        <div class="metric-value" id="performanceScore">-</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Estimated Cost</div>
                        <div class="metric-value" id="estimatedCost">-</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Execution Time</div>
                        <div class="metric-value" id="executionTime">-</div>
                    </div>
                </div>
            </div>
            
            <!-- Results Section -->
            <div class="results-section">
                <h2><i class="fas fa-chart-line"></i> Optimization Results</h2>
                
                <div class="results-tabs">
                    <div class="tab active" data-tab="suggestions">Suggestions</div>
                    <div class="tab" data-tab="execution">Execution Plan</div>
                    <div class="tab" data-tab="history">Query History</div>
                </div>
                
                <div class="tab-content active" id="suggestions-tab">
                    <div id="suggestionsList" class="suggestion-list">
                        <div class="suggestion-item">
                            <i class="fas fa-info-circle suggestion-icon" style="color: #4CAF50;"></i>
                            <div class="suggestion-info">
                                <div class="suggestion-title">Enter a SQL query to get optimization suggestions</div>
                                <div class="suggestion-desc">The optimizer will analyze your query and provide specific recommendations to improve performance.</div>
                            </div>
                            <span class="suggestion-severity severity-low">INFO</span>
                        </div>
                    </div>
                </div>
                
                <div class="tab-content" id="execution-tab">
                    <div class="chart-container">
                        <canvas id="executionPlanChart"></canvas>
                    </div>
                    <div id="executionDetails">
                        <p>Execution plan details will appear here after analysis.</p>
                    </div>
                </div>
                
                <div class="tab-content" id="history-tab">
                    <div class="history-list" id="queryHistory">
                        <div class="history-item">
                            <div class="history-query">SELECT * FROM users WHERE active = 1;</div>
                            <div class="history-meta">
                                <span>Saved: 2 hours ago</span>
                                <span>Performance: 87%</span>
                            </div>
                        </div>
                        <div class="history-item">
                            <div class="history-query">SELECT name, email FROM customers ORDER BY registration_date;</div>
                            <div class="history-meta">
                                <span>Saved: 1 day ago</span>
                                <span>Performance: 92%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Optimized Query Output -->
        <div class="input-section">
            <h2><i class="fas fa-magic"></i> Optimized Query</h2>
            <textarea id="optimizedQuery" placeholder="Optimized query will appear here..." readonly></textarea>
            <div class="query-actions">
                <button class="button" onclick="applyOptimizations()">
                    <i class="fas fa-check-circle"></i> Apply Optimizations
                </button>
                <button class="button secondary" onclick="copyOptimizedQuery()">
                    <i class="fas fa-copy"></i> Copy to Clipboard
                </button>
                <button class="button secondary" onclick="saveQuery()">
                    <i class="fas fa-save"></i> Save Query
                </button>
            </div>
        </div>
    </div>

    <script>
        // Application State
        const appState = {
            currentQuery: '',
            optimizedQuery: '',
            queryHistory: [],
            suggestions: [],
            performanceScore: 0,
            complexityScore: 0,
            executionTime: 0,
            estimatedCost: 0
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeTabs();
            loadQueryHistory();
            initializeChart();
        });

        // Tab functionality
        function initializeTabs() {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    // Remove active class from all tabs
                    document.querySelectorAll('.tab').forEach(t => {
                        t.classList.remove('active');
                    });
                    
                    // Add active class to clicked tab
                    this.classList.add('active');
                    
                    // Hide all tab contents
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // Show selected tab content
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                });
            });
        }

        // Initialize the execution plan chart
        function initializeChart() {
            const ctx = document.getElementById('executionPlanChart').getContext('2d');
            window.executionPlanChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Parsing', 'Planning', 'Execution', 'I/O', 'Network'],
                    datasets: [{
                        label: 'Time (ms)',
                        data: [0, 0, 0, 0, 0],
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.7)',
                            'rgba(54, 162, 235, 0.7)',
                            'rgba(255, 206, 86, 0.7)',
                            'rgba(75, 192, 192, 0.7)',
                            'rgba(153, 102, 255, 0.7)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: 'white'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: 'white'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: 'white'
                            }
                        }
                    }
                }
            });
        }

        // Load query history from localStorage
        function loadQueryHistory() {
            const savedHistory = localStorage.getItem('queryOptimizerHistory');
            if (savedHistory) {
                appState.queryHistory = JSON.parse(savedHistory);
                renderQueryHistory();
            }
        }

        // Save query to history
        function saveQueryToHistory(query, performanceScore) {
            const historyItem = {
                query: query,
                performanceScore: performanceScore,
                timestamp: new Date().toISOString()
            };
            
            appState.queryHistory.unshift(historyItem);
            
            // Keep only last 10 items
            if (appState.queryHistory.length > 10) {
                appState.queryHistory.pop();
            }
            
            // Save to localStorage
            localStorage.setItem('queryOptimizerHistory', JSON.stringify(appState.queryHistory));
            
            renderQueryHistory();
        }

        // Render query history
        function renderQueryHistory() {
            const historyContainer = document.getElementById('queryHistory');
            historyContainer.innerHTML = '';
            
            if (appState.queryHistory.length === 0) {
                historyContainer.innerHTML = '<p>No query history yet. Analyze some queries to build history.</p>';
                return;
            }
            
            appState.queryHistory.forEach(item => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.onclick = () => loadQueryFromHistory(item.query);
                
                const timeAgo = getTimeAgo(new Date(item.timestamp));
                
                historyItem.innerHTML = `
                    <div class="history-query">${item.query.substring(0, 80)}${item.query.length > 80 ? '...' : ''}</div>
                    <div class="history-meta">
                        <span>Saved: ${timeAgo}</span>
                        <span>Performance: ${item.performanceScore}%</span>
                    </div>
                `;
                
                historyContainer.appendChild(historyItem);
            });
        }

        // Calculate time ago
        function getTimeAgo(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 1) return 'just now';
            if (diffMins < 60) return `${diffMins} min ago`;
            if (diffHours < 24) return `${diffHours} hr ago`;
            return `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;
        }

        // Load query from history
        function loadQueryFromHistory(query) {
            document.getElementById('queryInput').value = query;
            // Switch to input tab
            document.querySelector('[data-tab="suggestions"]').click();
        }

        // Main optimization function
        function optimizeQuery() {
            const query = document.getElementById('queryInput').value.trim();
            
            if (!query) {
                alert('Please enter a SQL query to optimize.');
                return;
            }
            
            appState.currentQuery = query;
            
            // Show loading state
            document.getElementById('suggestionsList').innerHTML = `
                <div class="suggestion-item">
                    <i class="fas fa-spinner fa-spin suggestion-icon"></i>
                    <div class="suggestion-info">
                        <div class="suggestion-title">Analyzing your query...</div>
                        <div class="suggestion-desc">Please wait while we analyze your SQL query for optimization opportunities.</div>
                    </div>
                </div>
            `;
            
            // Simulate analysis delay
            setTimeout(() => {
                analyzeAndOptimize(query);
            }, 1000);
        }

        // Analyze without optimization
        function analyzeQuery() {
            const query = document.getElementById('queryInput').value.trim();
            
            if (!query) {
                alert('Please enter a SQL query to analyze.');
                return;
            }
            
            appState.currentQuery = query;
            analyzeAndOptimize(query, false);
        }

        // Core analysis and optimization logic
        function analyzeAndOptimize(query, applyOptimizations = true) {
            // Reset state
            appState.suggestions = [];
            
            // Calculate metrics
            calculateMetrics(query);
            
            // Generate suggestions
            generateSuggestions(query);
            
            // Generate optimized query if requested
            if (applyOptimizations) {
                generateOptimizedQuery(query);
            } else {
                document.getElementById('optimizedQuery').value = 'Enable optimization to see the improved query.';
            }
            
            // Update UI
            updateMetricsDisplay();
            renderSuggestions();
            updateExecutionPlan();
            
            // Save to history
            saveQueryToHistory(query, appState.performanceScore);
        }

        // Calculate query metrics
        function calculateMetrics(query) {
            // Simulate metric calculations based on query characteristics
            const lines = query.split('\n').length;
            const words = query.split(/\s+/).length;
            const joins = (query.match(/join/gi) || []).length;
            const subqueries = (query.match(/\(.*select.*\)/gi) || []).length;
            const wildcards = (query.match(/\*/g) || []).length;
            
            // Calculate complexity score (0-100)
            appState.complexityScore = Math.min(100, 
                Math.round((lines * 2) + (words * 0.1) + (joins * 15) + (subqueries * 20) + (wildcards * 5))
            );
            
            // Calculate performance score (inverse of complexity with optimizations applied)
            let performanceBase = 100 - (appState.complexityScore / 2);
            
            // Apply penalties for poor practices
            if (query.includes('SELECT *')) performanceBase -= 15;
            if (query.includes('WHERE') && !query.includes('INDEX')) performanceBase -= 10;
            if (query.includes('LIKE %value%')) performanceBase -= 20;
            if (query.includes('ORDER BY RAND()')) performanceBase -= 25;
            
            appState.performanceScore = Math.max(10, Math.round(performanceBase));
            
            // Calculate estimated execution time (ms)
            appState.executionTime = Math.round(
                (words * 0.5) + (joins * 10) + (subqueries * 50) + Math.random() * 100
            );
            
            // Calculate estimated cost (abstract units)
            appState.estimatedCost = Math.round(
                (words * 0.1) + (joins * 5) + (subqueries * 10)
            );
        }

        // Generate optimization suggestions
        function generateSuggestions(query) {
            appState.suggestions = [];
            
            // Check for SELECT *
            if (query.includes('SELECT *')) {
                appState.suggestions.push({
                    title: 'Avoid SELECT *',
                    description: 'Using SELECT * retrieves all columns, including ones you may not need. Specify only the required columns to reduce data transfer and improve performance.',
                    severity: 'high',
                    category: 'select'
                });
            }
            
            // Check for missing indexes
            if ((query.includes('WHERE') || query.includes('JOIN')) && !query.includes('INDEX')) {
                appState.suggestions.push({
                    title: 'Consider Adding Indexes',
                    description: 'Columns used in WHERE clauses and JOIN conditions should be indexed for faster data retrieval.',
                    severity: 'medium',
                    category: 'index'
                });
            }
            
            // Check for inefficient LIKE patterns
            if (query.includes('LIKE %')) {
                appState.suggestions.push({
                    title: 'Optimize LIKE Patterns',
                    description: 'Leading wildcards in LIKE patterns prevent index usage. Consider full-text search or rearranging the pattern if possible.',
                    severity: 'medium',
                    category: 'like'
                });
            }
            
            // Check for ORDER BY RAND()
            if (query.includes('ORDER BY RAND()')) {
                appState.suggestions.push({
                    title: 'Avoid ORDER BY RAND()',
                    description: 'ORDER BY RAND() is very inefficient for large datasets. Consider alternative approaches for random sampling.',
                    severity: 'high',
                    category: 'order'
                });
            }
            
            // Check for unnecessary columns in GROUP BY
            if (query.includes('GROUP BY')) {
                const selectMatch = query.match(/SELECT\s+(.*?)\s+FROM/i);
                if (selectMatch) {
                    const selectColumns = selectMatch[1].split(',').length;
                    const groupByColumns = (query.match(/GROUP BY/gi) || []).length;
                    
                    if (selectColumns > groupByColumns + 3) {
                        appState.suggestions.push({
                            title: 'Review GROUP BY Columns',
                            description: 'You might be grouping by more columns than necessary. Ensure all non-aggregated columns in SELECT are included in GROUP BY.',
                            severity: 'low',
                            category: 'group'
                        });
                    }
                }
            }
            
            // Check for potential N+1 query pattern
            if ((query.match(/SELECT/gi) || []).length > 2) {
                appState.suggestions.push({
                    title: 'Potential N+1 Query Pattern',
                    description: 'Multiple SELECT statements might indicate an N+1 query problem. Consider using JOINs or batch loading to reduce database round trips.',
                    severity: 'medium',
                    category: 'pattern'
                });
            }
            
            // If no issues found
            if (appState.suggestions.length === 0) {
                appState.suggestions.push({
                    title: 'Query Looks Well Optimized',
                    description: 'No significant optimization opportunities detected. Your query follows good practices.',
                    severity: 'low',
                    category: 'optimal'
                });
            }
        }

        // Generate optimized version of the query
        function generateOptimizedQuery(query) {
            let optimized = query;
            
            // Replace SELECT * with specific columns (simulated)
            if (query.includes('SELECT *')) {
                // In a real application, this would detect available columns
                optimized = optimized.replace(/SELECT \*/i, 'SELECT id, name, email');
            }
            
            // Add index hints (simulated)
            if (query.includes('WHERE') && !query.includes('INDEX')) {
                optimized += '\n\n-- Consider adding indexes on columns used in WHERE clauses';
            }
            
            // Suggest JOIN optimizations
            if (query.includes('JOIN') && !query.includes('INNER JOIN')) {
                optimized = optimized.replace(/JOIN/g, 'INNER JOIN');
            }
            
            appState.optimizedQuery = optimized;
            document.getElementById('optimizedQuery').value = optimized;
        }

        // Update metrics display
        function updateMetricsDisplay() {
            document.getElementById('complexityScore').textContent = appState.complexityScore;
            document.getElementById('performanceScore').textContent = `${appState.performanceScore}%`;
            document.getElementById('estimatedCost').textContent = appState.estimatedCost;
            document.getElementById('executionTime').textContent = `${appState.executionTime}ms`;
        }

        // Render suggestions in the UI
        function renderSuggestions() {
            const suggestionsList = document.getElementById('suggestionsList');
            suggestionsList.innerHTML = '';
            
            if (appState.suggestions.length === 0) {
                suggestionsList.innerHTML = '<p>No suggestions available.</p>';
                return;
            }
            
            appState.suggestions.forEach(suggestion => {
                const suggestionItem = document.createElement('div');
                suggestionItem.className = 'suggestion-item';
                
                // Set icon based on severity
                let icon = 'info-circle';
                let iconColor = '#4CAF50';
                
                if (suggestion.severity === 'medium') {
                    icon = 'exclamation-triangle';
                    iconColor = '#ff9800';
                } else if (suggestion.severity === 'high') {
                    icon = 'exclamation-circle';
                    iconColor = '#f44336';
                }
                
                suggestionItem.innerHTML = `
                    <i class="fas fa-${icon} suggestion-icon" style="color: ${iconColor};"></i>
                    <div class="suggestion-info">
                        <div class="suggestion-title">${suggestion.title}</div>
                        <div class="suggestion-desc">${suggestion.description}</div>
                    </div>
                    <span class="suggestion-severity severity-${suggestion.severity}">${suggestion.severity.toUpperCase()}</span>
                `;
                
                suggestionsList.appendChild(suggestionItem);
            });
        }

        // Update execution plan visualization
        function updateExecutionPlan() {
            if (window.executionPlanChart) {
                // Simulate execution plan data
                const newData = [
                    Math.random() * 10 + 5,  // Parsing
                    Math.random() * 20 + 10, // Planning
                    Math.random() * 100 + 50, // Execution
                    Math.random() * 80 + 30,  // I/O
                    Math.random() * 5 + 2     // Network
                ];
                
                window.executionPlanChart.data.datasets[0].data = newData;
                window.executionPlanChart.update();
                
                // Update execution details
                const executionDetails = document.getElementById('executionDetails');
                executionDetails.innerHTML = `
                    <p><strong>Execution Plan Summary:</strong></p>
                    <ul>
                        <li>Query uses ${(query.includes('JOIN') ? 'JOIN operations' : 'simple scan')}</li>
                        <li>Estimated rows processed: ${Math.round(appState.complexityScore * 10)}</li>
                        <li>Index usage: ${(query.includes('WHERE') && !query.includes('INDEX')) ? 'Limited' : 'Optimal'}</li>
                        <li>Memory usage: ${Math.round(appState.complexityScore * 2)} MB</li>
                    </ul>
                `;
            }
        }

        // Apply optimizations to the original query
        function applyOptimizations() {
            document.getElementById('queryInput').value = appState.optimizedQuery;
            showNotification('Optimizations applied to your query!');
        }

        // Copy optimized query to clipboard
        function copyOptimizedQuery() {
            const optimizedQuery = document.getElementById('optimizedQuery');
            optimizedQuery.select();
            document.execCommand('copy');
            showNotification('Optimized query copied to clipboard!');
        }

        // Save current query
        function saveQuery() {
            const query = document.getElementById('queryInput').value.trim();
            if (!query) {
                alert('No query to save.');
                return;
            }
            
            saveQueryToHistory(query, appState.performanceScore);
            showNotification('Query saved to history!');
        }

        // Clear query input
        function clearQuery() {
            document.getElementById('queryInput').value = '';
            document.getElementById('optimizedQuery').value = '';
            document.getElementById('suggestionsList').innerHTML = `
                <div class="suggestion-item">
                    <i class="fas fa-info-circle suggestion-icon" style="color: #4CAF50;"></i>
                    <div class="suggestion-info">
                        <div class="suggestion-title">Enter a SQL query to get optimization suggestions</div>
                        <div class="suggestion-desc">The optimizer will analyze your query and provide specific recommendations to improve performance.</div>
                    </div>
                    <span class="suggestion-severity severity-low">INFO</span>
                </div>
            `;
            
            // Reset metrics
            document.getElementById('complexityScore').textContent = '-';
            document.getElementById('performanceScore').textContent = '-';
            document.getElementById('estimatedCost').textContent = '-';
            document.getElementById('executionTime').textContent = '-';
        }

        // Load sample query
        function loadSampleQuery() {
            const sampleQuery = `SELECT * 
FROM orders o
JOIN customers c ON o.customer_id = c.customer_id
JOIN products p ON o.product_id = p.product_id
WHERE o.order_date > '2023-01-01'
AND c.country = 'USA'
ORDER BY o.order_date DESC
LIMIT 100;`;
            
            document.getElementById('queryInput').value = sampleQuery;
        }

        // Show notification
        function showNotification(message) {
            // Create notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                background-color: rgba(76, 175, 80, 0.9);
                color: white;
                border-radius: 6px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                z-index: 1000;
                font-weight: 600;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 3000);
        }
    </script>
</body>
</html>